<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using AI to Write Minimal, Modular, and Human-extensible Code | Mehtaverse</title>
    <meta name="author" content="Swapneel S. Mehta">
    <meta name="description" content="Researching online information networks and building tools to improve digital trust. 
">
    <meta name="keywords" content="postdoc, phd, research, digital platforms, trust, machine learning, social network">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/blog.css">
    <link rel="canonical" href="http://localhost:4000/using-ai-to-write-code/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/">Mehtaverse</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item ">
                <a class="nav-link" href="/blog/">blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>
              <li class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">contributions</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="https://unicode-research.netlify.app/people" rel="external nofollow noopener" target="_blank">mentorship</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/events/">organizing</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/code/">code</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/art/">art</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/jobs/">jobs</a>
                </div>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Using AI to Write Minimal, Modular, and Human-extensible Code</h1>
    <p class="post-meta">September 21, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/tag/students">
          <i class="fas fa-hashtag fa-sm"></i> students</a>  
          <a href="/blog/tag/getting-started">
          <i class="fas fa-hashtag fa-sm"></i> getting-started</a>  
          
        ·  
        <a href="/blog/category/blog">
          <i class="fas fa-tag fa-sm"></i> blog</a>  
          <a href="/blog/category/template">
          <i class="fas fa-tag fa-sm"></i> template</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>We used AI assistants in Cursor AI to recreate 2 years of work by ~20-member team of undergraduate students, graduate students, a postdoctoral researcher, and a couple of professors and I am writing this article to help people understand what it takes to write code using AI copilots.</p>

<p>For those of you who are engineers just looking to get the <em>gist of it</em>, incidentally here is a <a href="https://gist.github.com/SwapneelM/6ae57c10ae209361d6782e86d0801db0" rel="external nofollow noopener" target="_blank">Github gist</a> of how I created a product requirement document (PRD) by prompting Gemini, and then edited it surgically to get an <a href="https://gist.github.com/SwapneelM/6ae57c10ae209361d6782e86d0801db0#file-product-requirement-document-md" rel="external nofollow noopener" target="_blank">updated output PRD</a> that I could then use within cursor through multiple rounds of implementation-debugging-deployment cycles in order to rebuild our marketplace. But take a look at the marketplace first on the home page of our lab website, cheekily called <a href="https://truthmarket.com" rel="external nofollow noopener" target="_blank">Truth Market</a>, so that you understand what it means when I say “we built a two-sided marketplace for behavioral experimentation in Javascript”. And to be fair we did build it on top of an <em>experimental</em> (i.e. under active development) experimentation library (yes, I know it was confusing) called <a href="https://empirica.ly" rel="external nofollow noopener" target="_blank">Empirica</a>, developed largely as a labor of love at MIT. his file contains the prompts we used to get Cursor to design an entire platform for us (to be honest cursor did 35% of the work and we had to do 65% but it was of huge help either way!). Let me confirm that you did in fact check out the final version of the product that we developed, in the videos on the landing page at <a href="https://truthmarket.com" rel="external nofollow noopener" target="_blank">Truth Market</a>, and then I can walk you through how we went about using AI to help write code.</p>

<p>In this article–intended more for the students I work with and my team at the nonprofit I run called <a href="https://simppl.org" rel="external nofollow noopener" target="_blank">SimPPL</a> more than anyone else–are the things naive vibe coders might not grasp about assistants like Cursor, and I will use an intuitive example to help you understand why this is the case. I like examples siu=mply because they help me understand and ultimately remember ideas better.</p>

<h2 id="a-fictional-story-about-marco-and-gordon-to-teach-you-about-ai-coding">A Fictional story about Marco and Gordon to Teach you about AI Coding</h2>

<p>Say you are a chef called Marco, and you are opening a new restaurant in London. You would like to create a new take on a marvelous dessert, <a href="https://en.wikipedia.org/wiki/Cr%C3%A8me_br%C3%BBl%C3%A9e" rel="external nofollow noopener" target="_blank">Crème brûlée</a>, to round off the meal for a dinner that you are hosting for dignitaries at your new restaurant’s opening night. You have a genius idea to reinvent this age-old dish: if you could add some kind of spice (ginger, nutmeg, cinnamon), you could create a new variant of it! The sweetness will balance the spice and your restaurant will be the talk of the town (until they go back to featuring the next top TikTok trend, at least).</p>

<p>But come the morning of the event, you are held up on the tube (for non-Brits, read: <em>train</em>) and cannot make it in time to the kitchen! Oh no! But fear not, to help you save the day and create the dish, you have a second-in-command, or a <em><a href="https://en.wikipedia.org/wiki/Sous-chef" rel="external nofollow noopener" target="_blank">sous chef</a></em> that has made it to the restaurant and is busy preparing for the event. You give the sous chef a call!</p>

<p><em>“Gordon, listen to me!”</em></p>

<p><em>“Yes, Marco, what’s going on, I’m busy running your f*cking kitchen for you while you’re not around”</em></p>

<blockquote>
  <p>“Stop with the snarky attitude young man, it’s not my fault this tiny train full of smelly people (for Brits read: the tube) is stuck here, but while I get there, I need you to start to make the most marvelous spiced crème brûlée for dessert tonight! I’ll join you in making it when I get there.”</p>
</blockquote>

<blockquote>
  <p><em>“Yes chef, will do.”</em></p>
</blockquote>

<p>If that were all Marco needed to do for getting Gordon to make crème brûlée, life would be all rainbows and unicorns and while he made that, we would be able to eradicate poverty and achieve world peace. But sadly, that isn’t the case.</p>

<p>The first thing Gordon needs is a list of <em>ingredients</em>. He doesn’t know which ingredients exactly Marco wants him to use to make the crème brûlée. He finds that there are several different sets of ingredients people recommend for the same dish. And then there’s different brands that make each ingredient and he knows Marco is very particular about the brands he uses so he cannot just pick one at random. This dinner is the opening night and many food critics will be in attendance. The success of their restaurant might depend on it!</p>

<p>Gordon thinks to himself: <em>F*ck me, there’s way too many different lists of ingredients available online. I don’t know which one Marco wants. I should call him up again.</em></p>

<p>_“Marco, you didn’t tell me what are the ingredients to add in. There’s tons available online and even among our restaurant notes for I see at least 3 ingredient lists noted down. Can you clarify?”</p>

<p><em>“Ah yeah, follow the one with 3 hours of cooking time, 20 mins. prep time, for 4 servings. It should need 3 large egg yolks, 1/4 cup white sugar, 1 teaspoon vanilla extract, 1 cup heavy cream, 2 tablespoons white sugar, and 1 tablespoon brown sugar. Found it yet?”</em></p>

<p><em>“Yes, chef! But this is all for crème brûlée. What about the ‘spiced’ stuff that you want to use to reinvent this dish?”</em></p>

<p><em>“All in good time Gordon, let’s have you put together the tried-and-tested base ingredients first, then I’ll tell you about when to add in the spices. As an example, you remember how we made the puddings, mousses, and flans in the past few months. This will be similar in essence to the way we made those dishes with a spiced twist at the end of it. Capische?”</em></p>

<p><em>“Yes, chef!”</em></p>

<p>So now there is a list of ingredients but Gordon realizes he doesn’t know what to do first, preheat the oven (since prep time is barely 20 mins) and a larger oven takes longer to preheat, or to whisk the eggs together first. Also should he add sugar and cream in during or after whisking. Should the cream be room temperature or hot? Should he add any water in to improve the consistency? And at what point should he stop whisking if so?</p>

<p><em>“Chef Marco, sorry to bother you again, I need some details clarified. Can you tell me about the steps to follow in making this? When should I add in items, whether the cream should be hot or room temperature when mixed in, and whether I should add sugar before or after the cream? And again, what about the spices? I’m not sure how you want it.”</em></p>

<p><em>“Gordon, if you wanted the full recipe why didn’t you just ask for it? Look in the third drawer in my office desk. No wait, that’s where I keep my <a href="https://en.wikipedia.org/wiki/Labubu" rel="external nofollow noopener" target="_blank">Labubus</a>. Look in the fourth drawer and you’ll find a binder with the recipe for the dish. Follow the steps I’ve enlisted there, and start by sticking to the regular recipe for crème brûlée ok? I will tell you about the spices later.”</em></p>

<p><em>“Yes chef!”</em></p>

<p>So Gordon starts off and it is going well when he realizes they have an issue. The recipe was intended for 4 servings, but the dinner has several hundred guests. How should he get this done? Clearly, 4 servings at a time isn’t going to get anything done within time!</p>

<p><em>“Chef, I’m making following the recipe and making four servings but I need to get some advice on how to speed things up or we won’t be done on time!”</em></p>

<p><em>“Gordon–I hate to say this–but that’s actually a great point. I forgot that I had made that recipe for preparing a weekend dessert for my family of 4, not a dinner party of 75 guests. What you’ll want to do is set up three stations, one for egg whisking, one for mixing in hot cream and sugar, and an area for pouring it out into the <a href="https://en.wikipedia.org/wiki/Ramekin" rel="external nofollow noopener" target="_blank">ramekins</a> that you’ll find at the corner of the pantry on a shelf. Get help from a couple of others and staff each of the stations so you can do things faster. Use the electric whisk for the eggs, and use a larger pan to heat more portions of cream at once but be careful not to overheat it, and set up a couple of ovens so that you don’t have to wait to load multiple batches into them. That way you should be able to get things done faster!”</em></p>

<p><em>“Yes chef! Thank you.”</em></p>

<p><em>“Ok and now that you understand this, let me tell you about the spices: I just need you to add a pinch of ground nutmeg, ginger, and cinnamon to the mixture after the cream is in. So remember that’s about 1/4 teaspoon each, and additionally 1/8 teaspoon of cloves to the preparation. That should bring out the spiced flavor in the crème brûlée! Did you get all that?”</em></p>

<p><em>“Ohhh now I get it. Understood, yes chef!”</em></p>

<p>And things start progressing smoothly on Gordon’s end even as Marco’s train pulls up into the stop, he steps off and rushes on foot to the restaurant since he checked to see that there’s surge pricing on the apps and who hails a cab these days–it’s all in on technology or back to the stone age. So Marco, huffing and puffing, enters the kitchen and walks up in horror to see Gordon dropping literal pieces of ginger and semi-whole cinnamon sticks into the ramekin as he prepares the mix for crème brûlée!</p>

<p><em>“Gordon why the f*ck are you dropping pieces of uncut ginger and cloves into my dessert!?”</em></p>

<p><em>“But chef you said ground nutmeg, ginger, and cinnamon into the mix… so I added ground nutmeg, then added ginger, and then added cinnamon and I remembered to measure them out 1/4 teaspoon each!!! I just have to add in 1/8 teaspoons of whole cloves.”</em></p>

<p><em>“For f*ck’s sake Gordon, I meant ground EVERYTHING, nutmeg, ginger, and cinnamon–and of course I meant ground cloves not whole cloves. Who the f*ck has whole ginger, cloves, and sticks of cinnamon in a dessert dish? Use your f*cking brain!”</em></p>

<p><em>“But chef, it’s a new recipe, I thought you are innovating and I should respect your ideas!”</em></p>

<p>And Marco looks at his young protegé, with an expression that can only be described as incredulous disbelief, and sighs to himself. He lets out a deep sigh and walks over to the table to start picking whole ginger and cinnamon sticks out of the crème brûlée mix, thinking to himself <em>I only have myself to hold responsible for this.</em></p>

<p><em>“Ok Gordon, let’s start fixing the spiced crème brûlée. We can still salvage the remaining ones for the dinner.”</em></p>

<p><em>“Yes, chef!”</em></p>

<hr>

<p>And that, dear reader, is where I segue into AI copilots for accomplishing our tasks because the one statement that remains true for any copilot is that humans are really bad at expressing their ideas clearly the first time around. We learn, and we get better at it, but the reason that happens is we get <em>feedback</em> about our ideas! The one thing AI <em>does not do</em> is talk back at humans to tell them they’re not being clear, not expressing the right ideas, thinking in a logically incorrect manner, or asking it to do things that are functionally impossible to achieve. AI is trained to <em>just do it</em> (sorry, Nike). Even if it does an absolute garbage job and leaves you the worse off for it. So please, learn to give yourself that feedback especially when using AI for programming, because writing bad code is <em>really</em> easy! Just ask <a href="https://michalfita.medium.com/how-to-write-bad-code-6611a96a4da6" rel="external nofollow noopener" target="_blank">Michal Fita</a> about how to go from bad code to worse code, even without AI assistance.</p>

<h2 id="if-you-didnt-read-the-article-at-least-watch-this-video">If you didn’t read the article, at least watch this video</h2>

<p>I really like the video of a dad making a sandwich below as a great example of how to follow instructions <em>exactly as stated</em> and end up being unable to make even a simple peanut butter sandwich. AI is kinda like that, in fact it is exactly like that a lot of times, and I honestly wonder about the amount of “AI waste” produced because we need to correct prompts, and reprompt, and metaprompt just because it’s so easy to write bad prompts that we are all incentivized to <em>just prompt it</em> (I’m registering this one, Nike) without care for whether we need to add some ingredients, provide a recipe, and add bells and whistles to create our personal</p>

<p><a href="https://www.facebook.com/DailyMailVideo/videos/dad-follows-kids-sandwich-instructions-very-literally/764162380697425/" rel="external nofollow noopener" target="_blank">How to make a Peanut Butter Sandwich</a></p>

<h1 id="what-are-the-steps-that-we-learnt-about-prompting-ai-models-for-generating-code">What are the steps that we learnt about Prompting AI Models for Generating Code</h1>

<h2 id="step-1">Step 1</h2>

<p>First, you will understand the prompt we used to generate a product requirement document. If you do not know what that is, look up this <a href="https://www.atlassian.com/agile/product-management/requirements" rel="external nofollow noopener" target="_blank">Atlassian post</a> about it and then (and only then) read a <a href="https://coda.io/@yuhki/figmas-approach-to-product-requirement-docs" rel="external nofollow noopener" target="_blank">lightweight version</a> by Figma so you understand how you might reduce it down a little. Think of it as the ingredients AND recipe that the model needs for making the new dish.</p>

<p>Here is the prompt I used on <a href="https://aistudio.google.com/" rel="external nofollow noopener" target="_blank">Gemini (free)</a> in order to get an LLM to generate a PRD for me.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>I want you to look up and understand the documentation for the open-source behavioral experimentation library Empirica at https://docs.empirica.ly to understand the architecture it follows in designing two-sided games. I want you to think step by step to generate a clear and concise product requirement document to build a two-sided digital marketplace where some human buyers can "play" against some human sellers.  Each buyer has the goal of maximizing their individual utility gained from a product purchase through advertisements on a marketplace like Amazon, and each seller will gain a profit from the sale of a product in a marketplace like Amazon. The details of such a marketplace design can be extracted from the attached research paper in order to compose this product requirement document. I want you to be minimalistic and suggest only a single-round marketplace with Empirica stages as determined from the documentation.
Focus on the parts of the paper that talk about the marketplace design and suggest a concrete product requirement document along with suggested modularization of functionality that will be input into a copilot assistant to build out the codebase iteratively.
</code></pre></div></div>

<p>Now, I attached an entire research paper (<a href="https://drive.google.com/file/d/1UNFshEfII5MgMlAWUpAy_bVl5W8HIlJF/view?usp=sharing" rel="external nofollow noopener" target="_blank">this one</a>) in order to generate a PRD and that was OK but it did not work perfectly because at the end of the day your prompt has to have some more details and you can provide all the links, documentation, research papers, whitepapers, and such, but you will need to put in the hard work of editing and ensuring you are prompting your LLM with clear requirements that need to be reflected in the PRD. So here is the series of steps I followed in order to get the right PRD.</p>

<h2 id="step-2-go-section-wise-and-explain-your-motivation">Step 2: Go section-wise, and explain your motivation</h2>

<p>You really need to know what you want, <em>why</em> you want it, and need to convey that to the model. Just like Marco started with explaining to Gordon that this was for dessert, and did not explain how to add spices (in order to avoid confusing Gordon) until he got to the point of adding them in, first I get to <em>core</em> functionality and only then I get to UI/UX.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is good! But please make a reputation functionality (thumbs up and thumbs down application to a product seller by the product buyer who saw the advertisement for it) an explicit feature that can also be enabled or disabled based on Empirica factor within a treatment.
Also please enlist all of the game-specific nuances and select which of these you want to ensure are implemented as factors (hint: if there is a game variable that is changed in different market conditions for testing the effects of staked claims then they should be factors, so that it is easier to randomize them across games. These may include but not be limited to the cost, price, or value of a product, number of each type of seller--honest, cheat, bait-and-switch--in the market, number of human buyers, number of human sellers, number of LLM "agentic" sellers, presence of a stakesEnabled option, then they should be included as a factor)
Finally, I want you to also describe the UI/UX of each of the stages in detail so that the product designer may be able to better understand what kind of UI layouts to design for the project.
</code></pre></div></div>

<h2 id="step-3-provide-explicit-instructions-and-link-specific-documentation">Step 3: Provide explicit instructions and link specific documentation</h2>

<p>You will need to ensure the model is aware of documentation especially for custom libraries / software because otherwise you will run into issues with it designing everything from scratch! Marco had to explain to Gordon how to scale the recipe from a 4-serving family dinner into a 75-person seated dinner!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>First, you must review the documentation for Empirica v2 here: https://docs.empirica.ly/, then review the codebase here: https://github.com/empiricaly/empirica, and ensure that you understand how to architect this platform so that your product requirement document is aligned with features that the library supports.
The rest of your suggestions are fantastic, now please include a functionality where pricing for a product is determined by a slider that the producer selects. This allows elastic pricing (you can restrict to integer price values). The producer will choose to produce a certain quality of the product, but the pricing will be set by them to either be above or below fair market price for that product (fair market price falls exactly between the cost of production of a product and value gained by the consumer from its purchase). Profit is defined as the price minus the cost of production for the seller while consumer utility is defined as the value gained by the consumer minus the price paid for a product. So if the price selected by the seller on the slider is higher than the fair market price, then the seller makes a profit, and the consumer loses some utility compared to purchasing at the fair market price. Note that you will have to visually display the fair market price on another slider so that the seller makes an explicit choice about the production of a product.
Also note that if there are no humans on either side of the marketplace, that side should be automated (as in, there will be automatic decisions made by bots and LLM agents according to the strategies and prompts that they are preprogrammed or prompted with, respectively). Then, any humans entering the marketplace should only be assigned to roles that are intended for humanParticipants, and you need to accommodate the player assignment accordingly.
</code></pre></div></div>

<h2 id="step-4-modularize-the-results">Step 4: Modularize the Results</h2>

<p>Marco helped Gordon set up individual stations for scaling up the recipe for the dinner. Similarly, it is always better to split output into sections so that even when Cursor AI is programming your feature, it goes through tasks step-wise <em>and asks for your approval after each stage</em>. You <strong>must</strong> manually review the code Cursor AI writes otherwise you will almost certainly get fucked. This is not a joke. AI uses initial garbage code to generate even more garbage code. It is going to waste 2 mins today or 2 hrs tomorrow. You decide.
Never get AI to write code for an entire feature in a single step!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ok now review your PRD and ensure that it present a series of steps and separate stages that achieve the desired functionality in a clear, concise, and logical order for engineers to read it and start their programming implementation in Empirica. Generate a corresponding final draft with the required information.
</code></pre></div></div>

<h2 id="step-5-use-examples">Step 5: Use Examples</h2>

<p>Marco used the examples of mousse, pudding, and flan to help Gordon recognize their past experiences and process of making creamy desserts. For my part, as I noted the output of the model, I realized that this was looking too generic as a PRD and I could do better if I gave it examples of a product (in this case a behavioral experiment) that was built off of the base package I was using. This was super helpful because it included basic patterns from the library I was using <a href="https://docs.empirica.ly" rel="external nofollow noopener" target="_blank">Empirica</a> and allowed Cursor to follow those basic patterns and use builtin functionality rather than what it would otherwise do which is <em>build everything from scratch in JS</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>First, consider the code structure in this example repository and accordingly structure the files you will edit and components that you will create in your codebase following best practices for programming javascript based libraries: https://github.com/JamesPHoughton/prisonersDilemmaDemo
Summarize what you have learnt from this repository about the structure of Empirica projects and accordingly propose a file structure for our two-sided marketplace design. Then, lay out the stages that you will develop and the minimal set of variables that need to be defined in each stage. Next, go into the logic that needs to be included in each stage to account for market state updates. And finally, describe the UI/UX elements that need to be presented to the user in each stage so that the engineers reviewing this can understand what functionality is required on the frontend for the implementation of the product features you are describing.
When you are doing this, please be clear on the primitives for the experiment: cost of production (producer pays this), value of consumption (consumer gains this), and a fair market price that is the average of these two numbers that are originally set by the researchers running the experiment (game parameters). Note that since this is a product marketplace, the game parameter values are set as the minimum (low) quality, and maximum (high) quality and because of the slider permitting pricing flexibility for advertisements (that may mislead customers about the true quality of the product) the market price set by the producer need not match the fair market price but rather can take any interim integer values as well. This means that producers may actively decide to cheat consumers by charging them more (or less, though that would lose the producers money) than the fair market price for a product. Advertisements can be either high quality or low quality.
Producers make 4 choices in this game -- and this includes human producers, pre-programmed 'bot' producers that adapt to market conditions each round, and large language model based 'agentic' bot producers (three types: honest, cheat, and bait-and-switch) that dynamically determine these choices based on market conditions each round:
Choice of true quality of the product (high or low)
Choice of market price (between high and low cost price and the value of the product).
Choice of application of the truth warrant to a product
Choice of whether to rebrand and reenter the marketplace under a new seller name with their reputation history and warrant history wiped clean.
Consumers make two choices in this marketplace:
When shown products, they will decide whether or not to buy each product, for whatever number of products that their budget permits them to pay for.
When shown the results of their product purchase, they may elect to challenge any warranted product claims presented in product advertisements based on which they decided to purchase the product(s).
Design a PRD for the game accordingly.
</code></pre></div></div>

<h2 id="step-6-introduce-new-elements">Step 6: Introduce new elements</h2>

<p>The spices and all the other novelty is only introduced <em>after</em> you are sure your base instructions are clearly being followed. Only introduce new elements (read: bells and whistles) on top of your core feature <strong>AFTER</strong> your base functionality is crystal clear. There is absolutely no need to do it all at once and in fact you will almost certainly fail if you try to do so. Here, I start to introduce LLM bots into my experiment.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is a great start, and I want you to maintain this level of clarity when it comes to the design of the PRD for the experiment.
I want to make a change from the design presented earlier: we will enable ads to be of two qualities and the choice is made by the seller: high quality and low quality ads are both possible to produce.
Also, the LLM agent will use open-source javascript based libraries so that we avoid prompting and instead focus on programming language models so please review what axllm.dev and dspy suggest when it comes to a basic implementation within javascript: https://axllm.dev/ and https://dspy.ai are the URLs for each of them.
</code></pre></div></div>

<h2 id="step-7-get-minimum-viable-output">Step 7: Get minimum viable output</h2>

<p>Process matters a lot: that’s why Marco could fix mistakes that Gordon made even after he f*cked up. Explicitly prompt your model to generate output useful for build-test-deploy cycles so that the generated PRD is useful to buiold and test in an iterative manner (remember you must test the code at each iteration, not just after you’ve built the entire system out).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Great, let's structure our work as appropriate for a series of iterative build-test-deploy cycles for creating this marketplace starting with the prisonersDilemma demo (whose code is available at this Github URL: https://docs.empirica.ly/tutorials/beginner-experiment-prisoners-dilemma/part-4-coding-the-prisoners-dilemma-game) and indexing the documentation for this experiment (available at https://docs.empirica.ly/tutorials/beginner-experiment-prisoners-dilemma/part-4-coding-the-prisoners-dilemma-game) and suggesting how to build a multi-stage experiment as a single-round marketplace with two-sided competitive gameplay between buyers and sellers (including agentic AI sellers) in the marketplace.
</code></pre></div></div>

<p>This is how we generated the file below, which you can now go through in detail to understand what the PRD looks like. That PRD was the basis of 14 iterative build-test-deploy cycles with Cursor as I built out my platform. And even after each step in that 14-step process, I had to go through debugging stages which I enlisted in the debugging doc that is the <a href="https://gist.github.com/SwapneelM/6ae57c10ae209361d6782e86d0801db0#file-cursor-codebase-fixes-md" rel="external nofollow noopener" target="_blank">second file in the Github gist I shared earlier</a>.</p>

  </article>
</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2025 Swapneel S. Mehta. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.
Last updated: December 14, 2025.
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JW17M7JV1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ window.dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-1JW17M7JV1');
  </script>
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
